import Control.Monad

count (d, v) (top : rest) = go (d `mod` m) (drop v' rest) -- top row is not used
  where
    v' = v-1
    m = length top -- except for its width
    go k (row:rest) = (if row !! k == '#' then 1 else 0) + go ((k+d) `mod` m) (drop v' rest)
    go _ _ = 0

main = do
  forM mat putStrLn
  print $ count (3, 1) mat
  let counts = map (flip count mat) slopes
  print (counts, product counts)

slopes = [(1, 1),
          (3, 1),
          (5, 1),
          (7, 1),
          (1, 2)]

mat = if False then
  ["..##.......",
   "#...#...#..",
   ".#....#..#.",
   "..#.#...#.#",
   ".#...##..#.",
   "..#.##.....",
   ".#.#.#....#",
   ".#........#",
   "#.##...#...",
   "#...##....#",
   ".#..#...#.#"]
  else
  [".##.............##......#.....#",
   ".#.#................#..........",
   "...#..#.##..#.#......#.#.#.#..#",
   "..#......#........#..#..#.#.#..",
   ".......#....#..#..#.......#....",
   "..#..#..##.#...#........#.###..",
   "..#...#..#.....#.##....#.......",
   "....#..###.#......#.##..#...##.",
   "..#..........#.##.#...#........",
   "#...#............##....#..##...",
   ".......##....#.....##..#.#..#.#",
   "..#..#..#...#....#....#....#...",
   ".#...#.##........#####........#",
   "..#..#......#.....##...#.......",
   "....#......##....#.#....#.#..##",
   "#.#.##....##..#.........#.###..",
   "##..###..#..#.......###.......#",
   "...#.#......#.........#....#...",
   ".....#..........#.....##..#.#..",
   "....##......#.#..#....#.#......",
   "..#.....#..##.......##......#..",
   ".........##.##.#..##...........",
   "....#...#.....#....#.#.###....#",
   ".##.#..#...##..#.......#......#",
   "##..#..#..####..#.#..#...#.....",
   "..###..#..#..#.###..#....#.##..",
   "......#...###.#.#.....#........",
   ".....#...#.#...#.......#.....#.",
   "#........#..##...........#..#..",
   ".#.##.##...#.....#.#....#..#...",
   "..##.##....#.....#....#....##..",
   "#.........##...##..#.....#..#..",
   "........#.####....#...##.....#.",
   ".#.#...#..#..#.#......##.....#.",
   "..#..........##..#.#.#....#...#",
   "#.......#...#...#.....#.##.#...",
   "..#.....#..#.....####.#..#.#.##",
   "...#.#..#...#.....#...#.#.#.#.#",
   ".#..##....##.....#..#....###...",
   "....#......##.#.#.....#......#.",
   "..#.#...#......#.....##.......#",
   "..#...###...#..#.#...#..#.....#",
   "#..............#.....#....##..#",
   ".#...#.......#.............#...",
   "..###....#.##........#.#.......",
   "#.##.......#..#............###.",
   "#...#..##.#.#............######",
   "..##..#....#.#.###...#..##.##..",
   ".#...#.###.#....#...#....#...#.",
   "#...#.......#...........#...##.",
   "##.#......#####.............#..",
   "....#..#......##..#..........#.",
   "#.....#.....#.#.......#...#...#",
   "....#...#.#..##........#.#..##.",
   "..##.....##............#.#.###.",
   "#.........#........#..###......",
   "............#..................",
   ".#.###...####...#.#..#......#..",
   "...##.###.#....##.#..####..#.##",
   "..#####.#.##...#.#...##.##....#",
   "........##...#...#....##.....##",
   "#...........###...#.#...##.#...",
   "##......#...#.......###........",
   "..#..#.##.#..###....#..#.###.#.",
   "...#.#.#...#....#.##..#...#....",
   "........#.##...##.#.....##...##",
   ".#..........##..#..#..#.#...#..",
   "#.#...#.##.#....#.##..#........",
   ".#.#.#....##..##.####.....###..",
   "..#....##....#..#..#..##.......",
   "..##...#.......#...##.#....#...",
   "...####.#.#...........#.#...#..",
   "....####.....#.#.....#....##.##",
   "..#.....#.#.............##....#",
   "#.#....#####.##..####.#...#.#..",
   "#.#....#.##.#.#.##..#.#...#....",
   "......#.......#.......#.....#..",
   "..#.....#....###.###..#..#..#..",
   "#..#....##.###...##.....#......",
   "..#..#...#..#.##..........#....",
   "...#.#.#......#....#.##..#..##.",
   "....##.#....#..#...##....###...",
   "##.#.###.....#..#.#.#..#.....##",
   "##..#.#........#...#..#.#......",
   "....#.#.......##.#...........#.",
   ".......##...#...#...#.....#....",
   ".....#....#..#..###.#...#......",
   "............#.#..#......#.#....",
   "...##..#.##....##..##.#......#.",
   "#.#.#......#.#.....#.#.#..#.#.#",
   "...###..........#..#..#.##.....",
   "......#......#......###..##....",
   "#...##...#....#....#..#...#.#..",
   ".......#..#......##.......#....",
   "...#..#..#.....#.....#......##.",
   "..#....###..........##..#...#..",
   "..........#..#.#...#......#..#.",
   "#...#....#.##.........#.#.#...#",
   ".#.#.#...#.#...#.#..#..#....#.#",
   "#.##....#..#.........#.##.##..#",
   "..#.#..##.#....#.###.#...#....#",
   ".#.......#...#.#.........#....#",
   ".......#...#..........#.#..#...",
   "...#.....##..#....#...###...#.#",
   "#....##.##..........#.......#..",
   ".##..##......#...#....#.##....#",
   "....#.....##...##.#..#.........",
   "...#.#..##.#.#..#.......#....#.",
   ".#...#.#.#.#..#..#.##.......#..",
   "..#..##...#.#..#.......#.#####.",
   ".......#.#...........#....#.#..",
   ".#.###..........#...#..#...#...",
   "..#.#............##......##....",
   "...##..#...###...##....#.#.##..",
   "....#.##...#..#.#.#...........#",
   "....#..#....##.....#.##.#.....#",
   "..##......##.#.........#....#.#",
   "###...#...#..#.#...#...........",
   ".####.....#.....#.#....#..#....",
   ".#....#..#..#..#...##.....###.#",
   "#....##.#....#.##..#......##..#",
   ".........#..#.#.....#.#....##.#",
   ".....#.#...#....#.#...#....#..#",
   ".#...#.#.....#.#......#.#......",
   "#....##.......#.............#..",
   "#..#...#........##..#..#......#",
   "####..##.#..##..#.........####.",
   ".#.##..#.#..#.#.#.##...#..#.#.#",
   ".##.#..#............#......#...",
   "###....#.##....#..#...#........",
   ".....#..###..........#..#......",
   ".##..##.....#..##....#...#.....",
   "#...##...........#..#...###..#.",
   "#..##....#...#.##.##....#......",
   "...#...#..#.#.......##.......##",
   "....#.....#..#...#.........#.#.",
   ".#...##.#......#.#..#..#...##..",
   "...##...##.##...##...#..#......",
   "#..##.#..#..#............#...#.",
   "..#.....#.........#........#.#.",
   "#.#...#...#......#.#......#....",
   ".##.....##.#.#....#.##...##.#..",
   ".##..##.#.#....#.##............",
   ".#.##.....##.#...#...###....#..",
   ".#..............#.#....###.###.",
   "....#..#...#.#.#..........#.#.#",
   ".#.#..#.#.#...###..#...##......",
   ".#.#.....###......#..........#.",
   "........#.##...............#.#.",
   "...#.#.#......#..#..##........#",
   "..#.##......#.......#..#......#",
   "...#...#...#...#..#..#........#",
   "..#....#.....#....#..##........",
   ".....#..#...##....#......##....",
   "...##..##..#..........##....#.#",
   "..#....#..#...#.##..#.....##...",
   "###...#.#....#........#.......#",
   "......#...#..#....###.........#",
   "..###.#...#...#...#.#..###.#...",
   ".##.#.......#.#..#..#......#.#.",
   "...##...........#.#..#.#..#....",
   ".......#.....####.#.....#...#.#",
   "......##......##.#.#.#...#.#..#",
   "..###.#####..#....#.#...#..##..",
   ".....#..#......#........#......",
   "#..##....#.#.##....#....#......",
   ".#....#.##.####.##..#..#......#",
   "#...##...#.#...##.#.##.##...#..",
   "........#.#........#.#...#..#..",
   ".#....###..#......#.##.###..#..",
   ".#..#..#..#..#...#.#.........##",
   "....#...#..#..............#....",
   "........#...##.....#.......#...",
   "..#......#.#..#.#..#.#.#...###.",
   "....#...####....###....#......#",
   "#...#.#...................#.##.",
   "..#.#.###...#....##....##......",
   "#..##..#.........#....#....####",
   ".#....###...#.#...#......#...#.",
   "......#..#.#..#.##...#.#.#..#..",
   ".#...#.#.....#..##......#..#...",
   "##.#..##.....##.#.#.......##...",
   ".##.##.##..#...#.#.##.##.......",
   ".#.#......#.....#...#.#..#.....",
   "...#...........#..#.##..##..#..",
   ".....#...##......#........#.#..",
   "....#..............##.........#",
   "..####.#....##..##......##.#.#.",
   ".#.#..#...#..........#...###..#",
   "....#.#.##.....###.#..#.##.....",
   ".......##.#.#..#...#...##.#....",
   "...#.##.....#....#...#...#.....",
   "##.#.##..#..#.#.....#.#..#.....",
   "..#..##........#....###..#..#..",
   "..#.........##.....#......#...#",
   "...##..........##......#.#.#...",
   "#.....#..#..#......#......#....",
   ".##...#..##....#.......##..#.#.",
   ".#...##...##......####.##.#....",
   ".....#.........#.#.####......#.",
   "...#.....#.#.........##..#.....",
   "##.#.###.#..#.#..#............#",
   "...##..#.#....#....#..#........",
   "..#.###......#...#.#.....#...#.",
   "....##.##..#.....#...#.#.#....#",
   ".......#.#..#...........#.#....",
   ".#.#..##.#.......#.#..#.....###",
   "...#.#.....#.#..#.##..#...#.#..",
   "...#......##....#..............",
   "......#...#....................",
   "..#........#...##.##.#..#.#.#..",
   ".#.###.#.##..##..#....##....#..",
   ".....#..#.#...#.#..#..#.......#",
   "..........#.##.#..##..####.....",
   "............#.#......#.........",
   ".#....#..#......#.....##.......",
   ".....#........#.....##.#..#.#..",
   "#..#.##...#.#.....#...#.####...",
   "......#...#....#.##..##.#...#..",
   ".#.#.##......##....#.#....#.##.",
   "#.#.#....#.###....##....##.....",
   ".##..#...#.##......#..#..#...##",
   "...#....###....#...........#.#.",
   "#.#.##.##...##....#....##.#...#",
   ".#.#######.......#......#......",
   "#......#...#.#.#.###....#.##..#",
   "......##..#..##.........##.#.##",
   "....##...#.#....##.....#.....#.",
   "..#.#........##........#.#..##.",
   ".....#..#.##.....#.....#..#.#..",
   ".#..............#.......#......",
   ".............#..#..........#...",
   ".#..#.##....##.#..#...##.......",
   "...........#..#.......#.#....#.",
   ".#..#..........##...#.#.#...#..",
   "......#....#..###....#......#..",
   ".#...#...##..#..#..##..#..#.#..",
   "#.#.........#....#..........##.",
   "...##..#..##...#....##...##.##.",
   "..#....#.####.........#.....##.",
   ".....#.#...#.#...#.##.#...##..#",
   "#...#.....#..#.......#...#..#..",
   "..#.......#..##.#.....#....#...",
   ".#.....#..##.#.....#...#.#...#.",
   ".....#.##..........##....#...#.",
   "...#....#...#........##...#...#",
   "....##...#....#..........#.....",
   "...#....##..#..####..##.#...#.#",
   "#...###.###..#....##.#.........",
   ".#.......#......#.........#....",
   "..#..##..#.........##..........",
   "#......#.#.##...#...#####......",
   "......#.....####......#....#...",
   ".........#..#..#...#....#.#....",
   "....#........#...##....#.......",
   "...##.#...#..........#....#....",
   "........#.......#.##..#..#...#.",
   "....#..##...........#.....#..#.",
   "#....#...............#.#....#..",
   ".#........#....#.#...#.......#.",
   "#.......##..........#.......#..",
   "...#....#...##.#..#.......#....",
   "#..#.##...#.#...#...#...#....#.",
   "###...#...#....#....#....#...#.",
   "##......#.#.......#....#..#....",
   "......#......#....#.#.#..###..#",
   ".#.#.##.....#..#..........#....",
   "##...#.#.#..##....#.....#.#....",
   "#.##...#...#.#...####..#.......",
   ".....##..#.#.#....#..##..#.#...",
   "....###.#.........##.....#.....",
   "......##...........#........#.#",
   ".#.........##..................",
   ".........##...#.............#.#",
   "......##...#...#.........#..##.",
   "#..#.......#..##.......###.....",
   "....#.#.....#............##....",
   ".....#..#......#....#.....##...",
   "##......##...................#.",
   "#....#............#.#.###.##...",
   ".#.....#........#.....#...#....",
   "......##.......######......##..",
   ".#....##....#..###....#.......#",
   "..............##.#..#.......#.#",
   ".#..#..........#..#.##.........",
   "......##.#..#......#.#....##.#.",
   "#.....#.##...#.....#...#..#...#",
   ".#....#..##.....#.....#.#.#....",
   "..#......#.##..#.........#.#.#.",
   ".#..##...#...#.....#..#..#.#..#",
   "#.#.##.##.................#.#.#",
   ".#..#.#..##.#.......#.......##.",
   "#...#...#..##...#...##...#...#.",
   "....#......#..#...#.....##..#..",
   "..............##......#...#.#..",
   "..##..#.......#..#..###.#.#....",
   ".#..#..#...#.......#...#...##.#",
   ".#...#.......###..#.##.###.....",
   "##.#...#......#.....#..#.......",
   "##....##............#.....#..#.",
   ".....#...##......##.....#....##",
   "#...##..#....#..##....###.#...#",
   ".....#..#.#.....#.##..##....#..",
   ".#.....#.#........#...#.#......",
   "......#....#.#........#.#......",
   ".##..#...............###...##.#",
   ".......###.#.#......###.....#..",
   ".......#..##...#....#.##..#.##.",
   "..#.......##.......#.....#....#",
   ".#......#....#..##..#.#.#..##..",
   "###......#...#..#.............#",
   ".#....#..#.#......##...........",
   ".#....#.##.....#..#.......#..##",
   "....#...#...#..#.....#..##..#.#",
   "#.#.#.......##.#..#.#....#.....",
   "##.#.......#...#...#.#......##.",
   "#....#.#...........#######.....",
   "...#.#.##.#......##..###.......",
   "..#.#....#..#.................#",
   "........#..##..#.....#....#.##.",
   "...#.#..#..#..#..............##",
   ".##.......###.#......#....#..##",
   "..##.##.#......#....#..#...#..#"]
